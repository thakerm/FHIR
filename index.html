<!-- index.html -->
<script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<script>

        
//FHIR smart app that uses Observation?patient.identifier={}&code=http://loinc.org|83112-3
//to get the patient's PSA level
//and then uses the patient's PSA level to determine if the patient has prostate cancer

//smart on fhir gets patient name and id and displays on page


FHIR.oauth2.ready().then(smart => {
       patient = smart.patient;
       pt = patient.read();
        console.log(pt);

        $.when(pt).done(function(patient)
        {
        var fname = '';
          var lname = '';
          gender = patient.gender
            console.log(gender)
            fname = patient.name[0].given[0];
           console.log(fname);
          
           obv = smart.patient.request("Observation?code=http://loinc.org|2857-1").then(function(obv)
           {
                table = document.getElementById("PSA");
                console.log(obv);
               len = obv.entry.length;
               console.log("len", len);
              
               for(i=0;i<len;i++)
               {
                    //create new 
                    table += "<tr><td>"+obv.entry[i].resource.valueQuantity.value+"</td></tr>";
                    //table += "<tr>"+"Hi"+"</tr>";

               }
               //append table to html
                $("#PSA").append(table);
           });
           
        });

    })
    .catch(console.error);

</script>

<html>

<head>
    <title>SMART on FHIR App</title>
    </head>

    <body>
            <table id="PSA">

            </table>
    </body>

</html>