<!-- index.html -->
<script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<script>

    FHIR.oauth2.ready().then(smart => {
        console.log("Smart",smart);
        patient = smart.patient;
        pt = patient.read();
        console.log("Pt",pt);

        smart.patient.api.search({
  type: 'Observation',
  query: {
    code: 'http://loinc.org|2857-1'
  }
}).then(function(response) {
  // Handle the response containing the Observation data
  table = document.getElementById("PSA");
  var observations = response.data.entry;
  table += "<tr><td>" + obv.entry[i].resource.valueQuantity.value + "</td></tr>";
  // Process the observations as needed
}).catch(function(error) {
  // Handle any errors that occur during the request
});

        $.when(pt).done(function (patient) {
            var fname = '';
            var lname = '';
            patientID = smart.patient.id;
            console.log("Patient ID", patientID);
            gender = patient.gender
            age = patient.birthDate;
            console.log(gender)
            document.getElementById("name").innerHTML = "Welcome " + patient.name[0].given[0] + " " + patient.name[0].family;
            document.getElementById("gender").innerHTML = gender;
            document.getElementById("age").innerHTML = age;

           

            obv = smart.patient.request("Observation?code=http://loinc.org|2857-1").then(function (obv) {

                table = document.getElementById("PSA");
                console.log("obv", obv);
                len = obv.entry.length;
                console.log("len", len);

                for (i = 0; i < len; i++) {
                    //create new 
                    table += "<tr><td>" + obv.entry[i].resource.valueQuantity.value + "</td></tr>";
                    //table += "<tr>"+"Hi"+"</tr>";

                }
                //append table to html
                $("#PSA").append(table);
            });

        });

    })
        .catch(console.error);

</script>

<html>

<head>
    <title>SMART on FHIR App</title>
</head>

<body>
    <h1 id="name"></h1>
    <p id="gender"></p>
    <p id="age"></p>
    <table id="PSA">

    </table>
</body>

</html>