<!DOCTYPE html>
<html>
  <head>
    <title>SMART on FHIR App</title>
    <script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.min.js"></script>
    <script>
      FHIR.oauth2.ready().then(client => {
        console.log('Patient:', client.patient);
        
        function locatePSA() {
          const mrn = document.getElementById('mrn').value;
          client.request(`Observation?subject.identifier=${mrn}&code=PSA`).then(response => {
            console.log('Observation:', response);
            const table = document.getElementById('psa-table');
            table.innerHTML = `
              <tr>
                <th>Date</th>
                <th>Value</th>
                <th>Unit</th>
              </tr>
            `;
            response.entry.forEach(entry => {
              const observation = entry.resource;
              const date = observation.effectiveDateTime;
              const value = observation.valueQuantity.value;
              const unit = observation.valueQuantity.unit;
              const row = `
                <tr>
                  <td>${date}</td>
                  <td>${value}</td>
                  <td>${unit}</td>
                </tr>
              `;
              table.innerHTML += row;
            });
          });
        }
      });
    </script>
  </head>
  <body>
    <h1>SMART on FHIR App</h1>
    
    <hr>
    <table id="psa-table"></table>
  </body>
</html>
