<!-- index.html -->
<script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<script>

    FHIR.oauth2.ready().then(smart => { //starting in version 2.5 must use then or catch to get the smart object
        console.log("Smart", smart);
        patient = smart.patient;
        console.log("Patient", patient);
        pt = patient.read();
        console.log("Pt", pt);


        $.when(patient).done(function (patients) {
            var fname = '';
            var lname = '';
            patientID = smart.patient.id;
            console.log("Patient ID", patientID);
            gender = patients.gender
            age = patients.birthDate;
            console.log(gender)
            document.getElementById("name").innerHTML = "Welcome " + patients.name[0].given[0] + " " + patients.name[0].family;
            document.getElementById("gender").innerHTML = gender;
            document.getElementById("age").innerHTML = age;


            obv = smart.patient.request("Observation?code=http://loinc.org|2857-1").then(function (obv) {

                table = document.getElementById("PSA");
                console.log("obv", obv);
                len = obv.entry.length;
                console.log("len", len);

                for (i = 0; i < len; i++) {
                    //create new 
                    table += "<tr><td>" + obv.entry[i].resource.valueQuantity.value + "</td></tr>";
                    //table += "<tr>"+"Hi"+"</tr>";

                }
                //append table to html
                $("#PSA").append(table);
            });

        }).catch(console.error);

    })
        .catch(console.error);

</script>

<html>

<head>
    <title>SMART on FHIR App</title>
</head>

<body>
    <h1 id="name"></h1>
    <p id="gender"></p>
    <p id="age"></p>
    <table id="PSA">

    </table>
</body>

</html>